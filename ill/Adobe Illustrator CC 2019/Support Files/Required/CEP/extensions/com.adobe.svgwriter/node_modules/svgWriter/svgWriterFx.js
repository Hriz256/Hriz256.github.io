!function(){"use strict";var h=require("./svgWriterTag.js"),c=require("./svgWriterUtils.js");module.exports=new function(){var p=function(e,t,i,r){var o,n,s,l={},d=i.input||[],a=i.children||[],f=i["flood-opacity"];for(var u in l.result=i.id,"filter"==i.kind&&(l.id=i.id),f=null==f?1:f,i)"input"!=u&&"children"!=u&&"kind"!=u&&"input"!=u&&"id"!=u&&"flood-opacity"!=u&&("flood-color"==u?(f*=isFinite(i[u].alpha)?i[u].alpha:1,l[u]=c.writeColorNoOpacity(i[u],e)):l[u]=i[u]);for(f<1&&(l["flood-opacity"]=f),t&&("number"==typeof l.x&&(l.x+=(e._shiftContentX||0)+(e._shiftCropRectX||0)),"number"==typeof l.y&&(l.y+=(e._shiftContentY||0)+(e._shiftCropRectY||0))),n=0,s=d.length;n<s;++n)d[n]!=r&&(l["in"+(n?"2":"")]=d[n]);for(o=new h(i.kind,l),n=0,s=a.length;n<s;++n)o.appendChild(p(e,t,a[n],n?a[n-1].id:""));return o},s=function(e,t,i){var r=new h("filter"),o={};t.visualBounds&&(o.x=t.shifted?t.visualBounds.x+(e._shiftContentX||0)+(e._shiftCropRectX||0):t.visualBounds.x,o.y=t.shifted?t.visualBounds.y+(e._shiftContentY||0)+(e._shiftCropRectY||0):t.visualBounds.y,o.width=t.visualBounds.width,o.height=t.visualBounds.height,o.filterUnits="userSpaceOnUse"),r.setAttributes(o);for(var n=0;n<i.length&&n<1;++n)l["drop-shadow"](e,r,i[n]);return r.appendChild(new h("feComposite",{operator:"over",in:"SourceGraphic"})),r},l={"drop-shadow":function(e,t,i){var r=e.ID.getUnique("blur");t.appendChild(new h("feOffset",{dx:i.dx||0,dy:i.dy||0,input:"SourceAlpha"})),t.appendChild(new h("feGaussianBlur",{stdDeviation:i.r||0,result:r}));var o=isFinite(i.color.alpha)?i.color.alpha:1,n=c.writeColorNoOpacity(i.color,e);t.appendChild(new h("feFlood",{"flood-color":n,"flood-opacity":o})),t.appendChild(new h("feComposite",{operator:"in",in2:r}))}};this.externalizeStyles=function(t){var e,i,r,o=t.currentOMNode;if(o.style&&o.style.filters&&o.style.filters.length)for(var n=0;n<o.style.filters.length;n++){if((e=o.style.filters[n]).ref){if(!t.svgOM.resources||!t.svgOM.resources.filters[e.ref])continue;e=t.svgOM.resources.filters[e.ref]}if(e.params){if("dropShadow"==e.type){if(!e.params.dropShadows)continue;i=t.ID.getUnique("filter",t.currentOMNode.name),r=s(t,o,e.params.dropShadows)}else{if("svgFilter"!=e.type)continue;t.currentOMNode=e.params,i=t.ID.getUnique("filter",t.currentOMNode.name),t.currentOMNode.kind="filter",r=p(t,o.shifted,t.currentOMNode),t.currentOMNode=o}r.setAttribute("id",i),t.omStylesheet.def(r,function(e){t.omStylesheet.getStyleBlock(o).addRule("filter","url(#"+t.prefix+e.getAttribute("id")+")")});break}}}}}();