!function(){"use strict";var a=require("./svgWriterUtils.js").round1k,u=/-.*$/,o=/\s/g;function m(e,t){if(e){var n,r,s,i=0;for(var l in e.rules){if(!(l in t.rules))return;i+=(n=l,r=e.rules[l],s=t.rules[l],"font-family"==n&&(r=r.replace(u,"").replace(o,"").toLowerCase(),s=s.replace(u,"").replace(o,"").toLowerCase()),r==s)}return i}}function j(e,t,n,r){var s=new e("tspan",{},t,r);if(t._nextTspanAdjustSuper&&s.setAttribute("dy","0.6em"),r.position){var i,l,u=1.2,o=r.style._leading;o&&(i=r.style["font-size"])&&o.units===i.units&&(u=i.units?a(o.value/i.value):a(o/i)),t._nextTspanAdjustSuper||((i=i||r.style["font-size"]).units&&(i=i.value),l="em"===r.position.unitY?r.position.y*u*i:(n?u:0)*i,s.setAttribute("dy",l)),!r.style||"middle"!==r.style["text-anchor"]&&"end"!==r.style["text-anchor"]&&isFinite(r.position.x)?n&&s.setAttribute("x",r.position.x):"middle"!==r.style["text-anchor"]&&"end"!==r.style["text-anchor"]||(s.setAttribute("x",r.position.x),isFinite(r.position.deltaX)&&s.setAttribute("dx",r.position.deltaX))}return t._nextTspanAdjustSuper=!1,s}module.exports={makeTSpan:j,mergeTSpans2Tag:function(e,t,n,r){for(var s,i=e,l=e.constructor,u=[],o=[e],a=[],c=a,p=0,h=r.length;p<h;p++){for(var f,d=u.length,y={match:-1};d--;)(f=m(u[d],r[p].styleBlock))>y.match&&(y={match:f,full:f==Object.keys(r[p].styleBlock.rules).length,style:u[d],j:d});if(~y.match){var x=u.splice(y.j+1);o.splice(y.j+2);for(var v=0;v<x.length;v++)c=c.parent;if(i=o[o.length-1],y.full){r[p].text&&i.children.push(new l("#text",r[p].text));continue}}else i=e,u.length=0,o=[e];var g=[];c.push({style:r[p].styleBlock,children:g,parent:c}),g.parent=c,c=g,s=j(l,t,n,r[p]),r[p].text&&s.children.push(new l("#text",r[p].text)),u.push(r[p].styleBlock),o.push(s),i.children.push(s),i=o[o.length-1]}return function e(t,n){n=function(e){var t={};for(var n in e)t[n]=e[n];return t}(n);for(var r=0,s=t.length;r<s;r++){var i=t[r].style;for(var l in i.rules)n[l]==i.rules[l]?delete i.rules[l]:n[l]=i.rules[l];i.fingerprint=JSON.stringify(i.rules),t[r].children&&t[r].children.length&&e(t[r].children,n)}}(a,{}),e}}}();